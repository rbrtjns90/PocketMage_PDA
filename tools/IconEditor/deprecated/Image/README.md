# PocketMage Image Converters

C++ utilities to convert PNG/JPEG images to C bitmap arrays for use in PocketMage and other embedded projects.

## Tools

### 1. `image_to_icon` - PocketMage Icon Converter 
**Enhanced converter specifically designed for PocketMage 40x40 pixel icons**

Features:
- AUTO-CROPS: Automatically detects content bounds and removes white space
- FILLS SQUARE: Scales content to use entire 40x40 pixel area for maximum visibility
- COLOR INVERSION: `--invert` flag for negative/positive conversion
- SMART SCALING: Content-aware resizing eliminates empty borders
- Generates Proper C headers with descriptive comments

### 2. `image_to_bitmap` - General Bitmap Converter
**General-purpose converter for any image size**

Features:
- Supports PNG and JPEG input formats
- Converts to grayscale
- Converts to 1-bit monochrome bitmap using adjustable threshold
- Outputs C array format with PROGMEM attribute for Arduino/embedded use
- Handles images of any size
- Uses STB image library (header-only, no external dependencies)

## Building

```bash
# Build both converters
make

# Build only the PocketMage icon converter
make image_to_icon

# Build only the general bitmap converter  
make image_to_bitmap
```

This will:
1. Download the STB image library headers if needed
2. Compile the converters
3. Create the executables

## Usage

### PocketMage Icon Converter (`image_to_icon`) - Recommended 

```bash
./image_to_icon <input_image> <output_file> <array_name> [threshold] [--invert]
```

**Parameters:**
- `input_image`: PNG or JPEG file to convert
- `output_file`: Output C header file (.h)
- `array_name`: Name for the C array variable
- `threshold`: Grayscale threshold (0-255, default: 128)
- `--invert`: Optional flag to invert colors (whiteâ†”black)

**Examples:**
```bash
# Auto-crop pokeball to 40x40 icon
./image_to_icon pokeball.png pokeball_icon.h pokeballIcon

# Auto-crop with custom threshold
./image_to_icon atom.jpg atom_icon.h atomIcon 100

# Auto-crop with color inversion (great for atoms/molecules)
./image_to_icon hydrogen.png hydrogen_icon.h hydrogenIcon 128 --invert

# Any image becomes a perfect 40x40 PocketMage icon!
./image_to_icon any_image.png my_icon.h myAppIcon
```

### General Bitmap Converter (`image_to_bitmap`)

```bash
./image_to_bitmap <input_image> <output_file> <array_name> [threshold]
```

**Examples:**
```bash
# Convert any size image (preserves original dimensions)
./image_to_bitmap large_image.png large_bitmap.h largeBitmap

# Custom threshold for better contrast
./image_to_bitmap photo.jpg photo.h photoArray 150
```

## Output Format

### PocketMage Icons (40x40 pixels, 200 bytes)
```c
// 'iconName', 40x40px - PocketMage icon
const unsigned char iconName [] PROGMEM = {
  0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
  0x80, 0x00, 0x00, 0x00, 0x01,
  // ... exactly 40 rows of 5 bytes each (200 bytes total)
};
```

### General Bitmaps (any size)
```c
// 'bitmapName', WIDTHxHEIGHT bitmap  
const unsigned char bitmapName [] PROGMEM = {
  // Variable size based on input image dimensions
};
```

## Tips for Best Results

### For PocketMage Icons (image_to_icon)
- Any image size works - it will autocrop
- Use high contrast images for better e-ink display
- Try "--invert" flag for better contrast (especially atoms, molecules, dark subjects)
- Adjust threshold (80-180) if needed, but defaults usually work great
- Simple designs work best on small 40x40 displays

### Threshold Guidelines
- **Low threshold (50-100)**: More pixels become black, good for light images
- **Medium threshold (100-150)**: Balanced conversion, good for most images  
- **High threshold (150-200)**: More pixels become white, good for dark images

### Image Preparation
- High-contrast designs work best
- Bold outlines are ideal for small icons
- Consider the E-ink display's monochrome nature
- Don't worry about resizing - auto-crop handles it!

## Integration with PocketMage

### Easy Integration for Home Screen Icons
1. **Generate your icon**: "./image_to_icon my_image.png my_icon.h myAppIcon"
2. **Copy the array**: Copy the generated array from "my_icon.h" to `Code/PocketMage_V3/src/assets.cpp`
3. **Update the home screen**: Replace an existing icon in the "homeIconsAllArray" with your new icon name

### Example: Adding a New App Icon
```c
// 1. Generated by image_to_icon
const unsigned char myNewIcon [] PROGMEM = {
  // ... 200 bytes of icon data
};

// 2. In homeIconsAllArray (assets.cpp)
const unsigned char* homeIconsAllArray[10] = {
  _homeIcons2,
  _homeIcons3,
  myNewIcon,        // <- Replace an existing icon
  _homeIcons5,
  // ... rest of icons
};
```
## Cleaning Up

```bash
make clean
```

Removes compiled executables and generated test files.

## Dependencies

- C++11 compatible compiler (g++, clang++)
- STB image libraries (automatically downloaded by `make`)
- Standard C++ libraries only

## Third-Party Libraries

This project uses the following public domain libraries from the [stb](https://github.com/nothings/stb) collection by Sean Barrett and contributors:

### stb_image.h
- **Version**: v2.30
- **Author**: Sean Barrett (nothings.org)
- **License**: Public Domain / MIT (dual-licensed)
- **Purpose**: Image loading (PNG, JPEG, BMP, GIF, etc.)
- **Download**: https://github.com/nothings/stb/blob/master/stb_image.h
- **Raw**: https://raw.githubusercontent.com/nothings/stb/master/stb_image.h

### stb_image_resize2.h
- **Version**: v2.15
- **Authors**: Jeff Roberts (v2), Jorge L Rodriguez
- **License**: Public Domain / MIT (dual-licensed)
- **Purpose**: High-quality image resizing with SIMD support
- **Download**: https://github.com/nothings/stb/blob/master/stb_image_resize2.h
- **Raw**: https://raw.githubusercontent.com/nothings/stb/master/stb_image_resize2.h

### Manual Download
If the automatic download fails, you can manually download the headers:
```bash
curl -O https://raw.githubusercontent.com/nothings/stb/master/stb_image.h
curl -O https://raw.githubusercontent.com/nothings/stb/master/stb_image_resize2.h
mv stb_image_resize2.h stb_image_resize.h
```

### License Note
The STB libraries are released into the public domain (Unlicense) or alternatively available under the MIT license. See the header files for full license text.
